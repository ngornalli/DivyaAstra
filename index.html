<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divya Astra - Celestial Weapon Battle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Inter:wght@300;400;600;800&family=Tiro+Devanagari+Hindi&display=swap');

        :root {
            --card-aspect: 1; /* Changed to 1:1 Ratio */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            color: #e2e8f0;
            overflow: hidden;
        }

        h1, h2, h3, .font-serif { font-family: 'Cinzel', serif; }
        .font-hindi { font-family: 'Tiro Devanagari Hindi', serif; }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(15, 23, 42, 0.5); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #64748b; }

        /* Animations */
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .zoom-in { animation: zoomIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes zoomIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .slide-up { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Background Animation */
        .bg-animate { animation: bgMove 60s linear infinite alternate; }
        @keyframes bgMove { 0% { transform: scale(1); } 100% { transform: scale(1.15); } }

        /* Glassmorphism */
        .glass {
            background: rgba(2, 6, 23, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .card-glass {
            background: linear-gradient(180deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.95) 100%);
            backdrop-filter: blur(8px);
        }

        /* Volume Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 12px;
            width: 12px;
            border-radius: 50%;
            background: #f59e0b;
            cursor: pointer;
            margin-top: -4px;
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
            transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #334155;
            border-radius: 2px;
        }

        /* Circular Progress */
        .circular-chart { display: block; margin: 0 auto; max-width: 100%; max-height: 250px; }
        .circle-bg { fill: none; stroke: #1e293b; stroke-width: 2.5; }
        .circle {
            fill: none; stroke-width: 2.5; stroke-linecap: round;
            animation: progress 1.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
            transform-origin: center; transform: rotate(-90deg);
        }
        @keyframes progress { 0% { stroke-dasharray: 0 100; } }
        
        .stat-fill { width: 0; animation: fillBar 1s ease-out forwards; }
        @keyframes fillBar { to { width: var(--w); } }
        
        .stars {
            background-image: 
                radial-gradient(1.5px 1.5px at 20px 30px, #fff, rgba(0,0,0,0)),
                radial-gradient(1.5px 1.5px at 40px 70px, #fff, rgba(0,0,0,0)),
                radial-gradient(1.5px 1.5px at 50px 160px, #fff, rgba(0,0,0,0));
            background-repeat: repeat;
            background-size: 200px 200px;
            animation: stars 120s linear infinite;
            opacity: 0.4;
        }
        @keyframes stars { from { background-position: 0 0; } to { background-position: 0 1000px; } }

        .art-gradient {
            background: radial-gradient(circle at center, var(--color-light) 0%, var(--color-main) 60%, var(--color-dark) 100%);
        }
    </style>
</head>
<body class="flex flex-col h-screen text-slate-200 selection:bg-amber-500 selection:text-white bg-slate-950">

    <!-- Background -->
    <div class="fixed inset-0 pointer-events-none z-0 overflow-hidden">
        <div class="absolute inset-0 bg-cover bg-center bg-no-repeat bg-animate opacity-40" 
             style="background-image: url('https://images.unsplash.com/photo-1614730341194-75c6074065db?q=80&w=2074&auto=format&fit=crop');">
        </div>
        <div class="absolute inset-0 bg-gradient-to-b from-slate-950/95 via-slate-950/60 to-slate-950/95"></div>
        <div class="absolute inset-0 stars mix-blend-overlay"></div>
    </div>

    <!-- Navbar -->
    <header class="h-18 border-b border-white/5 flex items-center justify-between px-6 py-3 glass z-50 sticky top-0 shadow-2xl shadow-black/50">
        <div class="flex items-center gap-4 cursor-pointer group" onclick="location.reload()">
            <div class="relative">
                <div class="absolute inset-0 bg-amber-500 blur-lg opacity-20 group-hover:opacity-40 transition-opacity duration-500"></div>
                <div class="bg-gradient-to-br from-slate-800 to-slate-900 border border-amber-500/20 p-2.5 rounded-xl shadow-lg relative z-10 group-hover:border-amber-500/50 transition-colors">
                    <i data-lucide="swords" class="text-amber-400 w-5 h-5 group-hover:rotate-180 transition-transform duration-700 ease-out"></i>
                </div>
            </div>
            <div class="hidden md:block">
                <h1 id="app-title" class="text-lg font-bold tracking-[0.25em] font-serif text-transparent bg-clip-text bg-gradient-to-r from-amber-100 via-amber-300 to-amber-100 drop-shadow-sm">
                    DIVYA ASTRA
                </h1>
                <div class="h-0.5 w-1/3 bg-amber-500/50 mt-0.5 rounded-full"></div>
            </div>
        </div>
        
        <div class="flex items-center gap-3 md:gap-4">
            <div id="turn-indicator" class="hidden lg:flex items-center gap-2 px-4 py-1.5 rounded-full bg-slate-900/50 border border-slate-700/50 text-xs font-mono text-amber-400/90 shadow-inner"></div>

            <div class="flex items-center gap-2 border-r border-slate-800 pr-4 mr-1">
                <button id="rules-btn" class="p-2.5 rounded-lg text-slate-400 hover:text-amber-200 hover:bg-slate-800/80 transition-all relative group" title="Instructions">
                    <i data-lucide="book-open" class="w-5 h-5"></i>
                    <span class="absolute -bottom-8 left-1/2 -translate-x-1/2 text-[13px] bg-black px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap border border-slate-800">Rules</span>
                </button>

                <button id="ranking-btn" class="p-2.5 rounded-lg text-slate-400 hover:text-indigo-300 hover:bg-slate-800/80 transition-all relative group" title="Ranking">
                    <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                    <span class="absolute -bottom-8 left-1/2 -translate-x-1/2 text-[13px] bg-black px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap border border-slate-800">Rank</span>
                </button>
            </div>

            <!-- Enhanced Volume Control with Slider -->
            <div class="hidden sm:flex items-center gap-3 bg-slate-900/60 rounded-full pl-3 pr-4 py-1.5 border border-slate-800 hover:border-slate-700 transition-colors group">
                <button id="sound-btn" class="text-slate-500 hover:text-amber-400 transition-colors flex-shrink-0" title="Toggle Sound">
                    <i data-lucide="volume-x" class="w-4 h-4" id="sound-icon"></i>
                </button>
                <div class="w-20 flex items-center">
                    <input type="range" id="volume-slider" min="0" max="1" step="0.05" value="0.4" title="Volume Control">
                </div>
            </div>

            <div class="flex items-center gap-2 bg-slate-900/60 rounded-lg px-3 py-2 border border-slate-800 hover:border-slate-700 transition-colors cursor-pointer relative">
                <i data-lucide="globe" class="w-3.5 h-3.5 text-slate-500"></i>
                <select id="lang-select" class="bg-transparent border-none text-xs font-medium text-slate-300 focus:ring-0 cursor-pointer outline-none appearance-none pr-4">
                    <option value="en">English</option>
                    <option value="hi">Hindi</option>
                    <option value="mr">Marathi</option>
                    <option value="sa">Sanskrit</option>
                </select>
                <div class="absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none">
                    <i data-lucide="chevron-down" class="w-3 h-3 text-slate-500"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="main-container" class="flex-1 relative overflow-y-auto p-3 md:p-8 z-10 scroll-smooth">
        <!-- Views will be injected here via JS -->
    </main>

    <!-- Modals Container -->
    <div id="modal-container" class="relative z-50"></div>

    <script>
        // --- CONSTANTS & UTILS ---
        const STAT_COLORS = {
            destruction: "#ef4444", // Red
            precision: "#3b82f6",   // Blue
            range: "#10b981",       // Emerald
            speed: "#eab308",       // Yellow
            durability: "#f97316",  // Orange
            mysticism: "#a855f7"    // Purple
        };

        const BATTLE_MUSIC_URL = "https://cdn.pixabay.com/download/audio/2025/10/27/audio_4c5bfd53ba.mp3";

        const WEAPON_ICONS = {
            bow: "crosshair", sword: "sword", mace: "hammer", disc: "disc-3", spear: "move-diagonal-2",
            trident: "git-fork", lightning: "zap", fire: "flame", water: "waves", wind: "wind",
            magic: "sparkles", shield: "shield", default: "axe"
        };

        function getWeaponType(name, desc) {
            const n = name.toLowerCase();
            const d = desc.toLowerCase();
            if (n.includes("bow") || n.includes("arrow") || n.includes("dhanush")) return "bow";
            if (n.includes("sword") || n.includes("khadga")) return "sword";
            if (n.includes("mace") || n.includes("gada")) return "mace";
            if (n.includes("chakra") || n.includes("disc")) return "disc";
            if (n.includes("trishula") || n.includes("shoola")) return "trident";
            if (n.includes("spear") || n.includes("vel") || n.includes("shakti")) return "spear";
            if (n.includes("vajra") || n.includes("lightning")) return "lightning";
            if (n.includes("agni") || n.includes("fire")) return "fire";
            if (n.includes("varuna") || n.includes("water")) return "water";
            if (n.includes("vayu") || n.includes("wind")) return "wind";
            if (n.includes("brahma") || n.includes("astra")) return "magic";
            return "default";
        }

        // --- DATABASE ---
        const WEAPONS_DB = [
            { id: 1, name: "Sudarshana Chakra", name_hi: "‡§∏‡•Å‡§¶‡§∞‡•ç‡§∂‡§® ‡§ö‡§ï‡•ç‡§∞", deity: "Vishnu", color: "#0ea5e9", desc: "The spinning disc of cosmic order.", history: "Used by Krishna to destroy Shishupala.", specialty: "Inescapable homing", weaknesses: ["Cannot act against its creator"], stats: { destruction: 99, precision: 100, range: 95, mysticism: 98, speed: 100, durability: 100 } },
            { id: 2, name: "Brahmastra", name_hi: "‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§æ‡§∏‡•ç‡§§‡•ç‡§∞", deity: "Brahma", color: "#f59e0b", desc: "A weapon of mass destruction.", history: "Used by Ashwatthama and Arjuna.", specialty: "Nuclear-level devastation", weaknesses: ["Can be countered only by another Brahmastra"], stats: { destruction: 98, precision: 85, range: 95, mysticism: 92, speed: 88, durability: 90 } },
            { id: 3, name: "Trishula", name_hi: "‡§§‡•ç‡§∞‡§ø‡§∂‡•Ç‡§≤", deity: "Shiva", color: "#64748b", desc: "Shiva‚Äôs trident representing creation, preservation, and destruction.", history: "Used against Tripurasura.", specialty: "Absolute penetration", weaknesses: ["None known"], stats: { destruction: 97, precision: 96, range: 80, mysticism: 99, speed: 85, durability: 100 } },
            { id: 4, name: "Pashupatastra", name_hi: "‡§™‡§æ‡§∂‡•Å‡§™‡§§‡§æ‡§∏‡•ç‡§§‡•ç‡§∞", deity: "Shiva", color: "#4c1d95", desc: "The most destructive weapon of Shiva.", history: "Granted to Arjuna after penance.", specialty: "Unstoppable divine force", weaknesses: ["Can destroy creation if misused"], stats: { destruction: 100, precision: 92, range: 100, mysticism: 100, speed: 90, durability: 100 } },
            { id: 5, name: "Vajra", name_hi: "‡§µ‡§ú‡•ç‡§∞", deity: "Indra", color: "#facc15", desc: "Indra‚Äôs thunderbolt.", history: "Forged from Sage Dadhichi‚Äôs bones.", specialty: "Lightning strike", weaknesses: ["Cannot harm Shiva-protected beings"], stats: { destruction: 95, precision: 94, range: 85, mysticism: 88, speed: 97, durability: 95 } },
            { id: 6, name: "Nandaka Sword", name_hi: "‡§®‡§®‡•ç‡§¶‡§ï", deity: "Vishnu", color: "#0ea5e9", desc: "Sword representing knowledge and truth.", history: "Used to destroy ignorance.", specialty: "Cuts illusions", weaknesses: ["Requires spiritual discipline"], stats: { destruction: 90, precision: 95, range: 60, mysticism: 93, speed: 90, durability: 92 } },
            { id: 7, name: "Sharanga Bow", name_hi: "‡§∂‡§æ‡§∞‡§Ç‡§ó", deity: "Vishnu", color: "#38bdf8", desc: "Krishna‚Äôs celestial bow.", history: "Used in Mahabharata.", specialty: "Divine archery", weaknesses: ["Requires Vishnu‚Äôs energy"], stats: { destruction: 92, precision: 98, range: 100, mysticism: 90, speed: 89, durability: 95 } },
            { id: 8, name: "Pinaka", name_hi: "‡§™‡§ø‡§®‡§æ‡§ï", deity: "Shiva", color: "#1e3a8a", desc: "Shiva‚Äôs great bow.", history: "Destroyed Tripura.", specialty: "Cosmic arrows", weaknesses: ["Unusable by mortals"], stats: { destruction: 96, precision: 94, range: 100, mysticism: 99, speed: 88, durability: 98 } },
            { id: 9, name: "Agneyastra", name_hi: "‡§Ö‡§ó‡•ç‡§®‡•á‡§Ø‡§æ‡§∏‡•ç‡§§‡•ç‡§∞", deity: "Agni", color: "#dc2626", desc: "Creates an unquenchable fire.", history: "Used in both epics.", specialty: "Devouring flames", weaknesses: ["Countered by Varunastra"], stats: { destruction: 93, precision: 90, range: 85, mysticism: 80, speed: 92, durability: 85 } },
            { id: 10, name: "Varunastra", name_hi: "‡§µ‡§∞‡•Å‡§£‡§æ‡§∏‡•ç‡§§‡•ç‡§∞", deity: "Varuna", color: "#2563eb", desc: "Water weapon.", history: "Stops fire weapons.", specialty: "Flood creation", weaknesses: ["Weak against wind-based weapons"], stats: { destruction: 85, precision: 90, range: 88, mysticism: 82, speed: 88, durability: 87 } },
            { id: 11, name: "Vayavastra", name_hi: "‡§µ‡§æ‡§Ø‡§µ‡§æ‡§∏‡•ç‡§§‡•ç‡§∞", deity: "Vayu", color: "#93c5fd", desc: "Weapon of wind.", history: "Used to create storms.", specialty: "Cyclone strike", weaknesses: ["Blocked by mountains"], stats: { destruction: 89, precision: 87, range: 90, mysticism: 75, speed: 96, durability: 80 } },
            { id: 12, name: "Vasavi Shakti", name_hi: "‡§µ‡§æ‡§∏‡§µ‡•Ä ‡§∂‡§ï‡•ç‡§§‡§ø", deity: "Indra/Karna", color: "#ef4444", desc: "One-shot dart.", history: "Killed Ghatotkacha.", specialty: "Certain Death", weaknesses: ["Single use only", "Returns to Indra"], stats: { destruction: 94, precision: 100, range: 85, mysticism: 85, speed: 98, durability: 50 } },
            { id: 13, name: "Bhargavastra", name_hi: "‡§≠‡§æ‡§∞‡•ç‡§ó‡§µ‡§æ‡§∏‡•ç‡§§‡•ç‡§∞", deity: "Parashurama", color: "#b91c1c", desc: "Weapon of Parashurama.", history: "Used in Kshatriya extermination.", specialty: "Unmatched destruction", weaknesses: ["Requires Brahmin purity"], stats: { destruction: 94, precision: 90, range: 80, mysticism: 90, speed: 85, durability: 92 } },
            { id: 14, name: "Narayanastra", name_hi: "‡§®‡§æ‡§∞‡§æ‡§Ø‡§£‡§æ‡§∏‡•ç‡§§‡•ç‡§∞", deity: "Vishnu", color: "#0284c7", desc: "Multiplies with resistance.", history: "Used by Ashwatthama.", specialty: "Infinite homing fire", weaknesses: ["Must surrender to survive"], stats: { destruction: 100, precision: 98, range: 100, mysticism: 100, speed: 95, durability: 95 } },
            { id: 15, name: "Brahmashirsha", name_hi: "‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§∂‡•Ä‡§∞‡•ç‡§∑", deity: "Brahma", color: "#ea580c", desc: "4x Brahmastra.", history: "Threatened the universe.", specialty: "Apocalyptic", weaknesses: ["Causes drought for 12 years"], stats: { destruction: 99, precision: 90, range: 100, mysticism: 98, speed: 90, durability: 93 } },
            { id: 16, name: "Kaumodaki", name_hi: "‡§ï‡•å‡§Æ‡•ã‡§¶‡§ï‡•Ä", deity: "Vishnu", color: "#14b8a6", desc: "Divine mace.", history: "Used to slay Dantavakra.", specialty: "Shockwave", weaknesses: ["Close range only"], stats: { destruction: 92, precision: 65, range: 40, mysticism: 88, speed: 60, durability: 98 } },
            { id: 17, name: "Nagastra", name_hi: "‡§®‡§æ‡§ó‡§æ‡§∏‡•ç‡§§‡•ç‡§∞", deity: "Naga", color: "#16a34a", desc: "Summons venomous serpents.", history: "Used in Kurukshetra.", specialty: "Poison strike", weaknesses: ["Countered by Garuda"], stats: { destruction: 83, precision: 87, range: 75, mysticism: 80, speed: 85, durability: 82 } },
            { id: 18, name: "Anjalika Astra", name_hi: "‡§Ö‡§Ç‡§ú‡§≤‡§ø‡§ï‡§æ‡§∏‡•ç‡§§‡•ç‡§∞", deity: "Indra", color: "#d97706", desc: "Arrow that guarantees death.", history: "Used by Arjuna to kill Karna.", specialty: "Fatal precision", weaknesses: ["Cannot be reused"], stats: { destruction: 96, precision: 100, range: 90, mysticism: 90, speed: 95, durability: 80 } },
            { id: 19, name: "Gandiva", name_hi: "‡§ó‡§æ‡§Ç‡§°‡•Ä‡§µ", deity: "Agni", color: "#dbeafe", desc: "Arjuna‚Äôs divine bow.", history: "Gifted by Agni.", specialty: "Unlimited arrows", weaknesses: ["Needs immense strength"], stats: { destruction: 90, precision: 100, range: 100, mysticism: 85, speed: 95, durability: 95 } },
            { id: 20, name: "Kodanda Bow", name_hi: "‡§ï‡•ã‡§¶‡§£‡•ç‡§°", deity: "Rama", color: "#7c2d12", desc: "Bow of Lord Rama.", history: "Used against Ravana.", specialty: "Perfect aim", weaknesses: ["Only Rama can wield fully"], stats: { destruction: 92, precision: 100, range: 100, mysticism: 90, speed: 94, durability: 95 } }
        ];
        
        const TRANSLATIONS = {
            en: {
                title: "DIVYA ASTRA", subtitle: "Celestial Card Battle", enter: "Start Game", next: "Next Round",
                next_turn: "Next Turn", load_weapons: "Reforge Weapons", lore: "Lore", guru: "Guru", reincarnate: "Reincarnate",
                add_player: "Summon Warrior", start_war: "Begin War", start_battle: "Enter Battlefield", begin_round: "Next Round", select: "Invoke Attribute",
                reveal: "REVEAL POWER", clash: "CLASH!", winner: "WINNER", tie: "TIE", stats_hidden: "Unknown Power",
                preview_mode: "Arsenal Preview", sudden_death: "SUDDEN DEATH", turn: "'s Turn", points: "pts",
                legend_title: "Legendary Usage", final_result: "Epoch Result", grand_winner: "Samrat (Emperor)",
                instructions: "Sacred Texts", close: "Close", current_standings: "Current Standings",
                view_arsenal: "View Arsenal", arsenal_title: "Arsenal History", weak_points: "Limitations",
                rule_list: [
                    "üåå Objective: Accumulate the most Karma Points over 3 epic rounds.",
                    "‚öîÔ∏è Setup: 2-30 Warriors. Each receives 5 Divine Astras.",
                    "üëÄ Preview: Study your opponent's weapon deities before the clash.",
                    "üî• The Turn: The Active Warrior invokes a Power (e.g., Destruction). They cannot see the exact value!",
                    "üß† Strategy: Use the Lore and History to guess the strongest attribute.",
                    "üèÜ Scoring: Highest value wins the round (12 Karma Points shared among winners).",
                    "üîÑ Rotation: Keep your weapon until everyone has attacked. Then, new weapons are granted.",
                    "‚ò†Ô∏è Sudden Death: Ties are broken in a final single-round duel."
                ],
                stats: { destruction: "Destruction", precision: "Precision", range: "Range", speed: "Speed", durability: "Durability", mysticism: "Mysticism" },
                stat_descriptions: { destruction: "Raw damage potential.", precision: "Accuracy of the strike.", range: "Effective distance.", speed: "Velocity of attack.", durability: "Weapon resilience.", mysticism: "Spiritual energy." }
            },
            hi: { title: "‡§¶‡§ø‡§µ‡•ç‡§Ø ‡§Ö‡§∏‡•ç‡§§‡•ç‡§∞", subtitle: "‡§Æ‡§π‡§æ‡§Ø‡•Å‡§¶‡•ç‡§ß", enter: "‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠", next: "‡§Ö‡§ó‡§≤‡§æ ‡§¶‡•å‡§∞", next_turn: "‡§Ö‡§ó‡§≤‡•Ä ‡§¨‡§æ‡§∞‡•Ä", load_weapons: "‡§®‡§è ‡§∂‡§∏‡•ç‡§§‡•ç‡§∞", start_war: "‡§Ø‡•Å‡§¶‡•ç‡§ß ‡§Ü‡§∞‡§Ç‡§≠", start_battle: "‡§Ø‡•Å‡§¶‡•ç‡§ß ‡§∂‡•Å‡§∞‡•Ç", begin_round: "‡§Ö‡§ó‡§≤‡§æ ‡§¶‡•å‡§∞", select: "‡§ó‡•Å‡§£ ‡§ö‡•Å‡§®‡•á‡§Ç", reveal: "‡§∂‡§ï‡•ç‡§§‡§ø ‡§¶‡•á‡§ñ‡•á‡§Ç", clash: "‡§™‡•ç‡§∞‡§π‡§æ‡§∞!", winner: "‡§µ‡§ø‡§ú‡•á‡§§‡§æ", tie: "‡§ü‡§æ‡§à", stats_hidden: "‡§ó‡•Å‡§™‡•ç‡§§ ‡§∂‡§ï‡•ç‡§§‡§ø", preview_mode: "‡§∂‡§∏‡•ç‡§§‡•ç‡§∞ ‡§¶‡§∞‡•ç‡§∂‡§®", turn: " ‡§ï‡•Ä ‡§¨‡§æ‡§∞‡•Ä", points: "‡§Ö‡§Ç‡§ï", legend_title: "‡§™‡•å‡§∞‡§æ‡§£‡§ø‡§ï ‡§ï‡§•‡§æ", final_result: "‡§™‡§∞‡§ø‡§£‡§æ‡§Æ", grand_winner: "‡§ö‡§ï‡•ç‡§∞‡§µ‡§∞‡•ç‡§§‡•Ä ‡§∏‡§Æ‡•ç‡§∞‡§æ‡§ü", instructions: "‡§®‡§ø‡§Ø‡§Æ", close: "‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç", current_standings: "‡§∞‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó", view_arsenal: "‡§∂‡§∏‡•ç‡§§‡•ç‡§∞‡§æ‡§ó‡§æ‡§∞", arsenal_title: "‡§∂‡§∏‡•ç‡§§‡•ç‡§∞ ‡§á‡§§‡§ø‡§π‡§æ‡§∏", weak_points: "‡§ï‡§Æ‡§ú‡•ã‡§∞‡§ø‡§Ø‡§æ‡§Ç", stats: { destruction: "‡§µ‡§ø‡§®‡§æ‡§∂", precision: "‡§∏‡§ü‡•Ä‡§ï‡§§‡§æ", range: "‡§µ‡•ç‡§Ø‡§æ‡§™‡•ç‡§§‡§ø", speed: "‡§ó‡§§‡§ø", durability: "‡§¶‡•É‡§¢‡§º‡§§‡§æ", mysticism: "‡§Æ‡§æ‡§Ø‡§æ" }, stat_descriptions: { destruction: "‡§µ‡§ø‡§®‡§æ‡§∂ ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ", precision: "‡§∏‡§ü‡•Ä‡§ï‡§§‡§æ", range: "‡§¶‡•Ç‡§∞‡•Ä", speed: "‡§µ‡•á‡§ó", durability: "‡§ü‡§ø‡§ï‡§æ‡§ä‡§™‡§®", mysticism: "‡§ú‡§æ‡§¶‡•Ç" } },
            mr: { title: "‡§¶‡§ø‡§µ‡•ç‡§Ø ‡§Ö‡§∏‡•ç‡§§‡•ç‡§∞", subtitle: "‡§Æ‡§π‡§æ‡§Ø‡•Å‡§¶‡•ç‡§ß", enter: "‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ", next: "‡§™‡•Å‡§¢‡•Ä‡§≤ ‡§´‡•á‡§∞‡•Ä", next_turn: "‡§™‡•Å‡§¢‡§ö‡•Ä ‡§™‡§æ‡§≥‡•Ä", load_weapons: "‡§®‡§µ‡•Ä‡§® ‡§∂‡§∏‡•ç‡§§‡•ç‡§∞‡•á", start_war: "‡§Ø‡•Å‡§¶‡•ç‡§ß ‡§∏‡•Å‡§∞‡•Ç", start_battle: "‡§≤‡§¢‡§æ‡§à ‡§∏‡•Å‡§∞‡•Ç", begin_round: "‡§™‡•Å‡§¢‡•Ä‡§≤ ‡§´‡•á‡§∞‡•Ä", select: "‡§ó‡•Å‡§£ ‡§®‡§ø‡§µ‡§°‡§æ", reveal: "‡§∂‡§ï‡•ç‡§§‡•Ä ‡§™‡§π‡§æ", clash: "‡§™‡•ç‡§∞‡§π‡§æ‡§∞!", winner: "‡§µ‡§ø‡§ú‡•á‡§§‡§æ", tie: "‡§¨‡§∞‡•ã‡§¨‡§∞‡•Ä", stats_hidden: "‡§ó‡•Å‡§™‡•ç‡§§ ‡§∂‡§ï‡•ç‡§§‡•Ä", preview_mode: "‡§∂‡§∏‡•ç‡§§‡•ç‡§∞ ‡§¶‡§∞‡•ç‡§∂‡§®", turn: " ‡§ö‡•Ä ‡§™‡§æ‡§≥‡•Ä", points: "‡§ó‡•Å‡§£", legend_title: "‡§ï‡§•‡§æ", final_result: "‡§®‡§ø‡§ï‡§æ‡§≤", grand_winner: "‡§Æ‡§π‡§æ‡§µ‡§ø‡§ú‡•á‡§§‡§æ", instructions: "‡§®‡§ø‡§Ø‡§Æ", close: "‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡§æ", current_standings: "‡§ó‡•Å‡§£‡§´‡§≤‡§ï", view_arsenal: "‡§∂‡§∏‡•ç‡§§‡•ç‡§∞‡•á ‡§™‡§π‡§æ", arsenal_title: "‡§∂‡§∏‡•ç‡§§‡•ç‡§∞ ‡§á‡§§‡§ø‡§π‡§æ‡§∏", weak_points: "‡§ï‡§Æ‡§ï‡•Å‡§µ‡§§‡§™‡§£‡§æ", stats: { destruction: "‡§µ‡§ø‡§®‡§æ‡§∂", precision: "‡§Ö‡§ö‡•Ç‡§ï‡§§‡§æ", range: "‡§™‡§≤‡•ç‡§≤‡§æ", speed: "‡§µ‡•á‡§ó", durability: "‡§ü‡§ø‡§ï‡§æ‡§ä‡§™‡§£‡§æ", mysticism: "‡§ó‡•Ç‡§¢‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ" }, stat_descriptions: { destruction: "‡§µ‡§ø‡§®‡§æ‡§∂", precision: "‡§®‡•á‡§Æ‡§¨‡§æ‡§ú‡•Ä", range: "‡§™‡§≤‡•ç‡§≤‡§æ", speed: "‡§µ‡•á‡§ó", durability: "‡§ü‡§ø‡§ï‡§æ‡§ä‡§™‡§£‡§æ", mysticism: "‡§ú‡§æ‡§¶‡•Ç" } },
            sa: { title: "‡§¶‡§ø‡§µ‡•ç‡§Ø‡§æ‡§∏‡•ç‡§§‡•ç‡§∞‡§Æ‡•ç", subtitle: "‡§∏‡§Ç‡§ó‡•ç‡§∞‡§æ‡§Æ‡§É", enter: "‡§Ü‡§∞‡§≠‡§§‡§æ‡§Æ‡•ç", next: "‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ‡§É", next_turn: "‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ‡§É ‡§µ‡§æ‡§∞‡§É", load_weapons: "‡§®‡•Ç‡§§‡§®‡§∂‡§∏‡•ç‡§§‡•ç‡§∞‡§æ‡§£‡§ø", start_war: "‡§Ø‡•Å‡§¶‡•ç‡§ß‡§æ‡§∞‡§Æ‡•ç‡§≠‡§É", start_battle: "‡§Ü‡§∞‡§Æ‡•ç‡§≠‡§É", begin_round: "‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ‡§ö‡§ï‡•ç‡§∞‡§æ‡§∞‡§Æ‡•ç‡§≠‡§É", select: "‡§ö‡§ø‡§®‡•ã‡§§‡•Å", reveal: "‡§¶‡§∞‡•ç‡§∂‡§®‡§Æ‡•ç", clash: "‡§™‡•ç‡§∞‡§π‡§æ‡§∞‡§É!", winner: "‡§µ‡§ø‡§ú‡§Ø‡•Ä", tie: "‡§∏‡§æ‡§Æ‡•ç‡§Ø‡§Æ‡•ç", stats_hidden: "‡§ó‡•Å‡§™‡•ç‡§§‡§æ‡§É", preview_mode: "‡§∂‡§∏‡•ç‡§§‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§®‡§Æ‡•ç", turn: " ‡§µ‡§æ‡§∞‡§É", points: "‡§Ö‡§Ç‡§ï‡§æ‡§É", legend_title: "‡§ï‡§•‡§æ", final_result: "‡§™‡§∞‡§ø‡§£‡§æ‡§Æ‡§É", grand_winner: "‡§Æ‡§π‡§æ‡§µ‡§ø‡§ú‡§Ø‡•Ä", instructions: "‡§®‡§ø‡§Ø‡§Æ‡§æ‡§É", close: "‡§™‡§ø‡§ß‡§§‡•ç‡§§", current_standings: "‡§∏‡•ç‡§•‡§ø‡§§‡§ø‡§É", view_arsenal: "‡§∂‡§∏‡•ç‡§§‡•ç‡§∞‡§æ‡§ó‡§æ‡§∞‡§Æ‡•ç", arsenal_title: "‡§∂‡§∏‡•ç‡§§‡•ç‡§∞‡•á‡§§‡§ø‡§π‡§æ‡§∏‡§É", weak_points: "‡§¶‡•Å‡§∞‡•ç‡§¨‡§≤‡§§‡§æ", stats: { destruction: "‡§µ‡§ø‡§®‡§æ‡§∂‡§É", precision: "‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø‡§≠‡•á‡§¶‡§É", range: "‡§µ‡•ç‡§Ø‡§æ‡§™‡•ç‡§§‡§ø‡§É", speed: "‡§µ‡•á‡§ó‡§É", durability: "‡§∏‡•ç‡§•‡•à‡§∞‡•ç‡§Ø‡§Æ‡•ç", mysticism: "‡§Æ‡§æ‡§Ø‡§æ" }, stat_descriptions: { destruction: "‡§∂‡§ï‡•ç‡§§‡§ø‡§É", precision: "‡§Ö‡§ö‡•Ç‡§ï‡§§‡§æ", range: "‡§∏‡•Ä‡§Æ‡§æ", speed: "‡§ó‡§§‡§ø‡§É", durability: "‡§∏‡•ç‡§•‡•à‡§∞‡•ç‡§Ø‡§Æ‡•ç", mysticism: "‡§Æ‡§æ‡§Ø‡§æ" } }
        };

        TRANSLATIONS.hi = { ...TRANSLATIONS.en, ...TRANSLATIONS.hi };
        TRANSLATIONS.mr = { ...TRANSLATIONS.en, ...TRANSLATIONS.mr };
        TRANSLATIONS.sa = { ...TRANSLATIONS.en, ...TRANSLATIONS.sa };

        // --- STATE ---
        const state = {
            screen: 'setup', lang: 'en',
            players: [ 
                { id: 1, name: 'Arjuna', score: 0, deck: [], currentCard: null, usedWeapons: [] }, 
                { id: 2, name: 'Karna', score: 0, deck: [], currentCard: null, usedWeapons: [] } 
            ],
            turnIndex: 0, totalTurnsPlayed: 0, phase: 'preview', selectedStat: null, winningStatVal: 0, roundWinners: [], roundLog: "", maxRounds: 3, gameMode: 'normal',
            audio: new Audio(BATTLE_MUSIC_URL),
            volume: 0.4,
            isAudioPlaying: false,
            viewingPlayerId: null
        };

        state.audio.loop = true;
        state.audio.volume = state.volume;

        // --- AUDIO ---
        function toggleSound() {
            const slider = document.getElementById('volume-slider');
            if (state.isAudioPlaying) {
                state.audio.pause();
                state.isAudioPlaying = false;
                // Store current volume to restore later if needed, but slider visual stays
            } else {
                // If volume is 0, bump it up slightly so play works meaningfully
                if (state.volume <= 0.05) {
                    updateVolume(0.3);
                    slider.value = 0.3;
                }
                const playPromise = state.audio.play();
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        state.isAudioPlaying = true;
                    }).catch(error => {
                        console.log("Audio play blocked by browser policy until interaction.");
                        // alert("Please interact with the game to enable audio.");
                    });
                }
            }
            updateSoundIcon();
        }

        function updateVolume(val) {
            state.volume = parseFloat(val);
            state.audio.volume = state.volume;
            
            // If dragging slider, ensure audio is playing (unless volume is 0)
            if(state.volume > 0 && !state.isAudioPlaying && val > 0.05) {
               // Optionally auto-play when sliding volume up, or just update state
               // toggleSound(); // This might be annoying if auto-triggered
            }
            
            updateSoundIcon();
        }

        function updateSoundIcon() {
            const icon = document.getElementById('sound-icon');
            if (!icon) return;
            
            if (state.volume === 0 || !state.isAudioPlaying) {
                icon.setAttribute('data-lucide', 'volume-x');
                icon.classList.remove('text-amber-400');
                icon.classList.add('text-slate-500');
            } else if (state.volume < 0.5) {
                icon.setAttribute('data-lucide', 'volume-1');
                icon.classList.add('text-amber-400');
                icon.classList.remove('text-slate-500');
            } else {
                icon.setAttribute('data-lucide', 'volume-2');
                icon.classList.add('text-amber-400');
                icon.classList.remove('text-slate-500');
            }
            lucide.createIcons();
        }

        // --- LOGIC ---
        function getT() { return TRANSLATIONS[state.lang]; }
        
        function addPlayer() { 
            const input = document.getElementById('new-player-input'); 
            const name = input.value.trim(); 
            if (name && state.players.length < 30) { 
                state.players.push({ id: Date.now(), name, score: 0, deck: [], currentCard: null, usedWeapons: [] }); 
                input.value = ''; 
                render(); 
            } 
        }
        
        function removePlayer(id) { 
            if (state.players.length > 2) { 
                state.players = state.players.filter(p => p.id !== id); 
                render(); 
            } 
        }
        
        function updatePlayerName(id, newName) { 
            const p = state.players.find(pl => pl.id === id); 
            if (p) p.name = newName; 
        }
        
        function startWar() { 
            const deckSizeNeeded = state.players.length * 5;
            let pool = [...WEAPONS_DB];
            while(pool.length < deckSizeNeeded) {
                pool = [...pool, ...WEAPONS_DB]; 
            }
            const shuffled = pool.sort(() => Math.random() - 0.5);
            
            let wIdx = 0; 
            state.players.forEach((p) => { 
                p.score = 0; 
                p.deck = []; 
                p.usedWeapons = []; 
                for(let i=0; i<5; i++) { 
                    p.deck.push(shuffled[wIdx % shuffled.length]); 
                    wIdx++; 
                } 
                p.currentCard = p.deck[0]; 
                p.usedWeapons.push(p.currentCard); 
            }); 
            
            state.totalTurnsPlayed = 0; 
            state.phase = 'preview'; 
            state.screen = 'battle'; 
            state.gameMode = 'normal'; 
            state.maxRounds = 3; 
            render(); 
        }
        
        function enterCombat() {
            if (state.totalTurnsPlayed === 0) {
                state.turnIndex = Math.floor(Math.random() * state.players.length);
            }
            state.phase = 'select';
            render();
        }

        function selectStat(key) { 
            state.selectedStat = key; 
            state.phase = 'reveal_self'; 
            render(); 
        }
        
        function revealResult() { 
            state.phase = 'result'; 
            let maxVal = -1; 
            let winners = []; 
            state.players.forEach(p => { 
                if(p.currentCard) { 
                    const val = p.currentCard.stats[state.selectedStat]; 
                    if(val > maxVal) { 
                        maxVal = val; 
                        winners = [p.id]; 
                    } else if (val === maxVal) { 
                        winners.push(p.id); 
                    } 
                } 
            }); 
            state.roundWinners = winners; 
            state.winningStatVal = maxVal; 
            
            const points = Math.floor(12 / winners.length); 
            state.players.forEach(p => { 
                if(winners.includes(p.id)) p.score += points; 
            }); 
            
            const winnerNames = state.players.filter(p => winners.includes(p.id)).map(p => p.name).join(" & "); 
            const t = getT(); 
            state.roundLog = `${winnerNames} ${t.winner} (${t.stats[state.selectedStat]}: ${maxVal})`; 
            render(); 
        }
        
        function nextRound() { 
            const nextTurn = state.totalTurnsPlayed + 1; 
            
            if (nextTurn >= state.players.length * state.maxRounds) { 
                const maxScore = Math.max(...state.players.map(p => p.score)); 
                const winners = state.players.filter(p => p.score === maxScore); 
                if(winners.length > 1) { initiateTieBreaker(winners); return; } 
                state.screen = 'final_result'; render(); return; 
            } 
            
            let weaponsChanged = false;
            if (nextTurn % state.players.length === 0) { 
                state.players.forEach(p => { 
                    const used = p.deck.shift(); 
                    p.deck.push(used); 
                    p.currentCard = p.deck[0]; 
                    p.usedWeapons.push(p.currentCard); 
                });
                weaponsChanged = true;
            } 
            
            state.totalTurnsPlayed = nextTurn; 
            state.turnIndex = (state.turnIndex + 1) % state.players.length; 
            
            if(weaponsChanged) {
                state.phase = 'preview';
            } else {
                state.phase = 'select';
            }
            
            state.selectedStat = null; 
            state.roundWinners = []; 
            render(); 
        }
        
        function initiateTieBreaker(winners) { 
            state.gameMode = 'tiebreaker'; 
            state.maxRounds = 1; 
            state.totalTurnsPlayed = 0; 
            state.turnIndex = 0; 
            state.phase = 'preview'; 
            state.roundWinners = []; 
            
            const shuffled = [...WEAPONS_DB].sort(() => Math.random() - 0.5); 
            let wIdx = 0; 
            const tiePlayers = winners.map(p => { 
                const deck = [shuffled[wIdx++]]; 
                return { ...p, score: 0, deck: deck, currentCard: deck[0], usedWeapons: [deck[0]] }; 
            }); 
            state.players = tiePlayers; 
            render(); 
        }
        
        function setViewingPlayer(id) { state.viewingPlayerId = id; render(); }

        // --- RENDERER ---
        function getIconForStat(key) { 
            switch(key) { 
                case 'destruction': return 'flame'; 
                case 'precision': return 'crosshair'; 
                case 'range': return 'radar'; 
                case 'speed': return 'zap'; 
                case 'durability': return 'shield'; 
                case 'mysticism': return 'sparkles'; 
                default: return 'star'; 
            } 
        }

        function renderCardArt(weapon, isSmall = false) {
            const imageUrl = `https://raw.githubusercontent.com/ngornalli/DivyaAstra/refs/heads/main/image/${weapon.id}.jpg`;
            
            // Use object-contain to show full image. 
            // Use w-full h-full to fill the 1:1 container.
            return `
                <div class="w-full h-full relative overflow-hidden bg-slate-900 flex items-center justify-center">
                    <!-- Background blur for fill -->
                    <img src="${imageUrl}" class="absolute inset-0 w-full h-full object-cover opacity-50 blur-sm scale-110">
                    
                    <!-- Main Image -->
                    <img src="${imageUrl}" 
                         class="relative w-full h-full object-contain z-10 transition-transform duration-700 group-hover:scale-105"
                         alt="${weapon.name}"
                         loading="lazy"
                         onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\\'w-full h-full flex items-center justify-center bg-slate-900 text-slate-600\\'><i data-lucide=\\'image-off\\' class=\\'w-8 h-8\\'></i></div>'; lucide.createIcons();"
                    >
                    <div class="absolute inset-0 bg-gradient-to-t from-slate-950 via-transparent to-transparent opacity-60 z-20"></div>
                </div>
            `;
        }

        function render() {
            const t = getT();
            document.getElementById('app-title').innerText = t.title;
            const turnEl = document.getElementById('turn-indicator');
            
            if(state.screen === 'battle') {
                turnEl.innerHTML = state.gameMode === 'tiebreaker' 
                    ? `<span class="animate-pulse text-red-400 font-bold flex items-center gap-1"><i data-lucide="skull" class="w-3 h-3"></i> ${t.sudden_death}</span>` 
                    : `<i data-lucide="hourglass" class="w-3 h-3 text-amber-500"></i> <span>${t.next_turn}: ${state.totalTurnsPlayed + 1} / ${state.players.length * state.maxRounds}</span>`;
            } else turnEl.innerText = "";

            const container = document.getElementById('main-container');
            if (state.screen === 'setup') renderSetup(container, t);
            else if (state.screen === 'battle') renderBattle(container, t);
            else if (state.screen === 'final_result') renderFinal(container, t);
            
            const modalContainer = document.getElementById('modal-container');
            if(state.viewingPlayerId) {
                const p = state.players.find(pl => pl.id === state.viewingPlayerId) || state.players[0];
                modalContainer.innerHTML = renderArsenalModal(p, t);
            } else if (state.phase === 'select' || state.phase === 'reveal_self') {
                 const activePlayer = state.players[state.turnIndex];
                modalContainer.innerHTML = renderActiveModal(activePlayer, t);
            } else modalContainer.innerHTML = '';
            
            lucide.createIcons();
        }

        function renderSetup(container, t) {
            container.innerHTML = `
                <div class="max-w-md mx-auto mt-10 animate-in zoom-in">
                    <div class="text-center mb-8">
                        <div class="relative inline-block mb-4">
                            <div class="absolute inset-0 bg-amber-500 blur-xl opacity-20 rounded-full"></div>
                            <i data-lucide="swords" class="w-20 h-20 relative z-10 text-amber-500"></i>
                        </div>
                        <h2 class="text-4xl font-serif font-bold text-white mb-2 tracking-wider drop-shadow-lg">${t.subtitle}</h2>
                        <p class="text-slate-400 text-sm uppercase tracking-widest">2-30 Warriors</p>
                    </div>
                    <div class="glass rounded-2xl p-6 shadow-2xl border-t border-white/10 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-amber-500/50 to-transparent"></div>
                        
                        <div class="flex gap-2 mb-6 relative z-10">
                            <input id="new-player-input" type="text" placeholder="Warrior Name..." class="flex-1 bg-slate-950/60 border border-slate-700 rounded-xl px-4 py-3 text-sm focus:border-amber-500/50 focus:ring-1 focus:ring-amber-500/20 outline-none text-white placeholder-slate-500 transition-all shadow-inner">
                            <button onclick="addPlayer()" class="bg-gradient-to-br from-indigo-600 to-indigo-800 hover:from-indigo-500 hover:to-indigo-700 text-white p-3 rounded-xl transition-all shadow-lg shadow-indigo-500/20 border border-white/10 group">
                                <i data-lucide="user-plus" class="group-hover:scale-110 transition-transform"></i>
                            </button>
                        </div>
                        <div class="space-y-2 mb-8 max-h-60 overflow-y-auto custom-scrollbar pr-2 relative z-10">
                            ${state.players.map(p => `
                                <div class="flex items-center justify-between bg-slate-800/30 p-3 rounded-xl border border-slate-700/50 hover:bg-slate-800/60 hover:border-slate-600 transition-all group slide-up">
                                    <input oninput="updatePlayerName(${p.id}, this.value)" value="${p.name}" class="bg-transparent border-none outline-none text-sm font-bold text-slate-200 w-full"/>
                                    <button onclick="removePlayer(${p.id})" class="text-slate-600 hover:text-red-400 transition-colors opacity-0 group-hover:opacity-100 p-1 hover:bg-red-500/10 rounded-lg">
                                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                        <button onclick="startWar()" class="w-full bg-gradient-to-r from-amber-600 to-orange-700 text-white font-bold py-4 rounded-xl uppercase tracking-[0.15em] text-sm flex items-center justify-center gap-2 hover:scale-[1.02] active:scale-[0.98] transition-all shadow-xl shadow-orange-600/20 border border-white/10 relative overflow-hidden group">
                            <span class="absolute inset-0 bg-white/20 translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700"></span>
                            <i data-lucide="swords" class="w-4 h-4"></i> ${t.start_war}
                        </button>
                    </div>
                </div>`;
        }

        function renderBattle(container, t) {
            let gridClass = "grid-cols-2 md:grid-cols-3 lg:grid-cols-4"; 
            const count = state.players.length;
            if (count <= 2) gridClass = "grid-cols-2 max-w-3xl mx-auto"; 
            else if (count <= 6) gridClass = "grid-cols-1 md:grid-cols-3"; 
            else if (count <= 12) gridClass = "grid-cols-1 md:grid-cols-4"; 
            else gridClass = "grid-cols-2 md:grid-cols-5 lg:grid-cols-6";
            
            const isRoundOver = (state.totalTurnsPlayed + 1) % state.players.length === 0;
            const btnText = (state.totalTurnsPlayed + 1) >= state.players.length * state.maxRounds ? t.final_result : (isRoundOver ? t.load_weapons : t.next_turn);

            const donutColor = state.selectedStat ? STAT_COLORS[state.selectedStat] : '#eab308';
            const winnerDonut = state.phase === 'result' ? `
                <div class="flex items-center gap-3 bg-slate-900/80 rounded-xl px-4 py-1.5 border border-slate-700 shrink-0 shadow-inner">
                    <div class="relative w-8 h-8">
                        <svg viewBox="0 0 36 36" class="circular-chart w-full h-full">
                            <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                            <path class="circle" stroke-dasharray="${state.winningStatVal}, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" style="stroke: ${donutColor};" />
                        </svg>
                         <div class="absolute inset-0 flex items-center justify-center text-[12px] font-bold text-white">${state.winningStatVal}</div>
                    </div>
                    <div class="text-[13px] uppercase font-bold text-slate-300 hidden md:block">
                        ${state.selectedStat ? t.stats[state.selectedStat] : ''}
                    </div>
                </div>
            ` : '';

            container.innerHTML = `
                <div class="flex flex-col items-center h-full w-full relative">
                    ${state.phase === 'preview' ? `
                        <div class="w-full max-w-lg glass rounded-2xl p-6 mb-8 text-center shadow-2xl animate-bounce z-30 absolute top-10 border-t border-white/10">
                            <h3 class="text-amber-400 font-bold uppercase tracking-widest text-sm mb-2 flex items-center justify-center gap-2">
                                <i data-lucide="eye"></i> ${t.preview_mode}
                            </h3>
                            <p class="text-xs text-slate-400 mb-4 leading-relaxed">Memorize the Deities and Weapons before the clash begins.</p>
                            <button onclick="enterCombat()" class="w-full py-3 bg-gradient-to-r from-indigo-600 to-indigo-800 hover:from-indigo-500 hover:to-indigo-700 text-white font-bold text-sm uppercase tracking-widest rounded-xl shadow-lg hover:scale-[1.02] transition-transform border border-white/10">
                                ${state.totalTurnsPlayed === 0 ? t.start_battle : t.begin_round}
                            </button>
                        </div>
                    ` : ''}
                    ${state.phase === 'result' ? `
                    <div class="w-full max-w-3xl glass rounded-xl p-3 mb-8 shadow-2xl z-30 sticky top-2 flex flex-col md:flex-row items-center justify-between gap-4 slide-up border-t border-amber-500/20">
                         <div class="flex items-center justify-between w-full gap-4 px-2">
                            <div class="text-amber-100 font-bold text-sm md:text-lg drop-shadow-sm truncate flex-1">${state.roundLog}</div>
                            ${winnerDonut}
                         </div>
                         <button onclick="nextRound()" class="w-full md:w-auto px-6 py-2 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-500 hover:to-orange-500 text-white font-bold text-xs uppercase tracking-widest rounded-lg shadow-lg shrink-0 whitespace-nowrap transition-transform hover:scale-105 ring-2 ring-amber-500/30 ring-offset-2 ring-offset-slate-900 border border-white/10">${btnText}</button>
                    </div>` : ''}
                    <div class="grid ${gridClass} gap-4 md:gap-6 w-full pb-20 px-2">${state.players.map((p, idx) => renderPlayerCard(p, idx === state.turnIndex, t)).join('')}</div>
                </div>`;
        }

        function renderPlayerCard(player, isActive, t) {
            const weapon = player.currentCard; 
            const isWinner = state.roundWinners.includes(player.id); 
            const showStats = state.phase === 'result';
            
            let borderColor = 'rgba(30, 41, 59, 0.5)'; 
            if (isActive || isWinner || state.phase === 'preview') borderColor = weapon.color;
            
            return `
                <div class="relative flex flex-col bg-slate-900/90 backdrop-blur-md rounded-2xl border transition-all duration-500 overflow-hidden group ${isActive ? 'scale-[1.02] z-20 shadow-2xl ring-1 ring-white/20' : 'opacity-90 hover:opacity-100 hover:-translate-y-1 hover:shadow-xl'}" style="border-color: ${borderColor}; box-shadow: ${isActive || isWinner ? `0 0 30px ${weapon.color}20` : 'none'}">
                    ${isWinner ? `<div class="absolute inset-0 border-[3px] rounded-2xl animate-pulse pointer-events-none z-50" style="border-color: ${weapon.color}"></div>` : ''}
                    
                    <!-- Header -->
                    <div class="flex justify-between items-center bg-slate-950/80 p-3 border-b border-white/5">
                        <div class="font-bold text-xs text-slate-200 truncate max-w-[100px] uppercase tracking-wide">${player.name}</div>
                        <div class="flex items-center gap-1.5 text-[13px] font-mono px-2 py-0.5 rounded-full bg-slate-900 border border-slate-700" style="color: ${weapon.color}">
                            <i data-lucide="trophy" class="w-3 h-3"></i> ${player.score}
                        </div>
                    </div>

                    <!-- Image (Square Ratio) -->
                    <div class="aspect-square bg-black relative overflow-hidden group-hover:brightness-110 transition-all">
                        ${renderCardArt(weapon)}
                        <div class="absolute bottom-0 w-full p-3 text-center flex flex-col items-center justify-end bg-gradient-to-t from-slate-950 via-slate-950/90 to-transparent min-h-[5rem] z-20">
                             <div class="text-sm font-serif font-bold drop-shadow-md mb-0.5 whitespace-normal leading-tight text-white tracking-wide">${weapon.name}</div>
                             <div class="text-[13px] font-hindi text-slate-400 whitespace-normal leading-none opacity-80">${weapon.name_hi}</div>
                        </div>
                    </div>

                    <!-- Extended Details Body -->
                    <div class="flex-1 p-4 bg-slate-900/95 flex flex-col gap-3 border-t border-white/5 min-h-[200px]">
                        
                        <!-- Deity & Specialty -->
                        <div class="flex justify-between items-start gap-2 pb-2 border-b border-white/5">
                            <div class="flex flex-col gap-0.5">
                                <span class="text-[9px] text-slate-500 uppercase tracking-wider font-bold">Deity</span>
                                <span class="text-[13px] text-indigo-300 font-bold flex items-center gap-1"><i data-lucide="sparkles" class="w-3 h-3"></i> ${weapon.deity}</span>
                            </div>
                            <div class="flex flex-col gap-0.5 items-end text-right">
                                <span class="text-[9px] text-slate-500 uppercase tracking-wider font-bold">Specialty</span>
                                <span class="text-[13px] text-amber-200 font-medium max-w-[100px] truncate">${weapon.specialty}</span>
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="bg-slate-950/50 p-2.5 rounded-lg border border-white/5 shadow-inner">
                            <p class="text-[13px] text-slate-400 italic leading-relaxed line-clamp-3">"${weapon.desc}"</p>
                        </div>

                        <!-- Weakness -->
                        <div class="flex items-center gap-2 text-[13px] text-red-300/90 bg-red-950/20 px-2.5 py-1.5 rounded border border-red-500/10">
                            <i data-lucide="shield-alert" class="w-3 h-3 flex-shrink-0 text-red-400"></i>
                            <span class="truncate w-full">Weakness: ${weapon.weaknesses[0]}</span>
                        </div>

                        <!-- Action / Result Status (Pinned to Bottom) -->
                        <div class="mt-auto pt-2">
                            ${(state.phase === 'select' || state.phase === 'reveal_self') ? `
                                <div class="text-slate-600 text-[13px] uppercase tracking-widest flex flex-col items-center gap-2 bg-slate-950 rounded-lg p-2 border border-slate-800 shadow-sm">
                                    ${isActive ? `<span style="color: ${weapon.color}" class="font-bold flex items-center gap-2 animate-pulse"><i data-lucide="loader-2" class="w-3 h-3 animate-spin"></i> Selecting...</span>` : `<span class="flex items-center gap-1.5 text-slate-500"><i data-lucide="eye-off" class="w-3 h-3"></i> ${t.stats_hidden}</span>`}
                                </div>
                            ` : ''}
                            
                            ${(state.phase === 'result' && showStats && state.selectedStat) ? `
                                <div class="flex flex-col items-center w-full zoom-in bg-slate-950 rounded-lg p-2 border border-slate-800 shadow-lg">
                                    <div class="text-[9px] uppercase mb-1.5 font-bold tracking-wider" style="color: ${STAT_COLORS[state.selectedStat]}">${t.stats[state.selectedStat]}</div>
                                    <div class="w-full h-1.5 bg-slate-800 rounded-full mb-1 overflow-hidden relative shadow-inner">
                                        <div class="h-full rounded-full relative" style="width: ${weapon.stats[state.selectedStat]}%; background: ${STAT_COLORS[state.selectedStat]}; box-shadow: 0 0 12px ${STAT_COLORS[state.selectedStat]}"></div>
                                    </div>
                                    <div class="text-xl font-black text-white drop-shadow-lg tabular-nums">${weapon.stats[state.selectedStat]}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>`;
        }

        function renderActiveModal(player, t) {
            const weapon = player.currentCard;
            const statButtons = Object.keys(t.stats).map(key => `
                <button onclick="selectStat('${key}')" onmouseenter="document.getElementById('stat-desc').innerText = '${t.stat_descriptions[key]}'" onmouseleave="document.getElementById('stat-desc').innerText = 'INVOKE POWER'" class="py-4 px-2 bg-slate-900/40 text-white border border-slate-700/50 hover:border-white/50 rounded-xl uppercase text-[13px] md:text-xs font-bold tracking-widest transition-all hover:scale-105 hover:bg-slate-800/60 flex flex-col items-center gap-2 group relative overflow-hidden shadow-lg backdrop-blur-sm" style="border-bottom: 2px solid ${STAT_COLORS[key]}60">
                    <div class="absolute inset-0 bg-gradient-to-br from-transparent to-white/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <div class="p-2 rounded-full bg-slate-950/50 border border-slate-800 group-hover:border-slate-600 transition-colors">
                        <i data-lucide="${getIconForStat(key)}" class="w-5 h-5 transition-colors" style="color: ${STAT_COLORS[key]}"></i>
                    </div>
                    <span class="relative z-10 transition-colors group-hover:text-white text-slate-400" style="color: ${STAT_COLORS[key]}">${t.stats[key]}</span>
                </button>`).join('');
            
            const selectedKey = state.selectedStat;
            const otherKeys = Object.keys(t.stats).filter(k => k !== selectedKey);
            const val = selectedKey ? weapon.stats[selectedKey] : 0;

            const selectedStatHTML = `
                <div class="flex flex-col items-center justify-center p-4 animate-in zoom-in mb-4">
                    <div class="relative w-36 h-36 md:w-48 md:h-48">
                        <svg viewBox="0 0 36 36" class="circular-chart w-full h-full drop-shadow-[0_0_15px_rgba(0,0,0,0.8)]">
                            <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" style="stroke: #0f172a; stroke-width: 2;" />
                            <path class="circle" stroke-dasharray="${val}, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" style="stroke: ${selectedKey ? STAT_COLORS[selectedKey] : '#334155'}; stroke-width: 2.5; stroke-linecap: round; filter: drop-shadow(0 0 8px ${selectedKey ? STAT_COLORS[selectedKey] : '#000'});" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span class="text-5xl font-black text-white drop-shadow-xl counter-anim tracking-tighter">${val}</span>
                            <span class="text-[13px] uppercase font-bold tracking-[0.2em] mt-1" style="color: ${selectedKey ? STAT_COLORS[selectedKey] : '#64748b'}">${selectedKey ? t.stats[selectedKey] : '...'}</span>
                        </div>
                    </div>
                </div>`;

            const otherStatsHTML = otherKeys.map(key => {
                const otherVal = weapon.stats[key];
                return `
                    <div class="flex items-center gap-3 p-2 hover:bg-white/5 rounded-lg transition-colors">
                        <div class="w-7 h-7 rounded-lg bg-slate-900 border border-slate-700 flex items-center justify-center shrink-0 shadow-sm">
                             <i data-lucide="${getIconForStat(key)}" class="w-3.5 h-3.5" style="color: ${STAT_COLORS[key]}"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between mb-1">
                                <span class="text-[9px] uppercase font-bold text-slate-400 tracking-wide">${t.stats[key]}</span>
                                <span class="text-[9px] font-mono font-bold text-white">${otherVal}</span>
                            </div>
                            <div class="w-full h-1.5 bg-slate-800 rounded-full overflow-hidden shadow-inner">
                                <div class="stat-fill h-full rounded-full" style="--w: ${otherVal}%; background-color: ${STAT_COLORS[key]}; opacity: 0.9;"></div>
                            </div>
                        </div>
                    </div>`;
            }).join('');

            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-lg fade-in p-4">
                    <div class="relative w-full max-w-5xl p-1 animate-in zoom-in duration-300">
                        <div class="absolute -inset-1 rounded-3xl blur-xl opacity-30 animate-pulse" style="background: ${weapon.color}"></div>
                        <div class="relative bg-slate-950 rounded-2xl shadow-2xl overflow-hidden flex flex-col md:flex-row border border-white/10 max-h-[90vh] md:h-auto overflow-y-auto md:overflow-visible">
                            
                            <!-- Card Visual Side -->
                            <div class="w-full md:w-5/12 min-h-[300px] md:min-h-[550px] relative flex flex-col">
                                <div class="absolute inset-0">
                                    ${renderCardArt(weapon)}
                                </div>
                                <div class="relative z-10 p-8 mt-auto bg-gradient-to-t from-slate-950 via-slate-950/90 to-transparent">
                                    <div class="text-xs text-indigo-200 uppercase font-bold mb-2 flex items-center gap-2 bg-white/5 w-fit px-2 py-1 rounded-md backdrop-blur-sm border border-white/10">
                                        <i data-lucide="sparkles" class="w-3 h-3"></i> ${weapon.deity}
                                    </div>
                                    <div class="text-4xl font-bold font-serif tracking-wide leading-none text-white mb-2 drop-shadow-lg">${weapon.name}</div>
                                    <div class="text-xl font-hindi text-white/70 tracking-wide">${weapon.name_hi}</div>
                                </div>
                            </div>

                            <!-- Card Stats Side -->
                            <div class="w-full md:w-7/12 p-6 md:p-8 bg-slate-950/95 flex flex-col justify-center relative border-l border-white/5">
                                <div class="relative z-10 flex flex-col h-full">
                                    <div class="flex items-center justify-between mb-6 border-b border-slate-800 pb-4">
                                        <div>
                                            <div class="text-xs text-slate-500 uppercase tracking-widest font-bold mb-1">Current Turn</div>
                                            <h2 class="text-2xl font-bold text-white tracking-wide">${player.name}</h2>
                                        </div>
                                        <div class="text-xs text-slate-600 font-mono bg-slate-900 px-2 py-1 rounded border border-slate-800">ID: ${weapon.id.toString().padStart(3, '0')}</div>
                                    </div>

                                    ${state.phase === 'select' ? `
                                        <div class="mb-6 bg-slate-900/50 p-5 rounded-xl border border-slate-700/50 backdrop-blur-sm relative overflow-hidden">
                                            <div class="absolute top-0 right-0 p-2 opacity-10"><i data-lucide="scroll-text" class="w-20 h-20 text-white"></i></div>
                                            <div class="flex items-center gap-2 text-xs font-bold uppercase tracking-widest mb-3 pb-2 border-b border-slate-700/50 relative z-10" style="color: ${weapon.color}">
                                                <i data-lucide="book-open" class="w-4 h-4"></i> ${t.legend_title}
                                            </div>
                                            <p class="text-slate-300 text-sm italic leading-relaxed font-serif relative z-10">"${weapon.history || weapon.desc}"</p>
                                            
                                            <div class="mt-4 flex flex-wrap gap-2 relative z-10">
                                                 ${weapon.weaknesses.map(w => `<span class="px-2 py-1 rounded-md bg-red-900/10 border border-red-500/20 text-[13px] text-red-300/80 flex items-center gap-1"><i data-lucide="shield-alert" class="w-3 h-3"></i> ${w}</span>`).join('')}
                                            </div>
                                        </div>
                                        
                                        <div class="mt-auto">
                                            <div class="flex items-center gap-4 mb-3">
                                                <div class="h-px bg-slate-800 flex-1"></div>
                                                <p id="stat-desc" class="text-center text-slate-500 text-[13px] uppercase tracking-widest font-bold">INVOKE POWER</p>
                                                <div class="h-px bg-slate-800 flex-1"></div>
                                            </div>
                                            <div class="grid grid-cols-3 gap-3">
                                                ${statButtons}
                                            </div>
                                        </div>
                                    ` : `
                                        <div class="flex-1 flex flex-col">
                                            <div class="text-center mb-4">
                                                <span class="text-xs text-slate-500 uppercase tracking-[0.2em] border-b border-slate-800 pb-1">Power Manifestation</span>
                                            </div>
                                            
                                            <div class="mb-6 flex justify-center">
                                                ${selectedStatHTML}
                                            </div>
                                            
                                            <div class="grid grid-cols-2 gap-x-6 gap-y-2 mb-6 bg-slate-900/50 p-4 rounded-xl border border-slate-800 shadow-inner">
                                                ${otherStatsHTML}
                                            </div>

                                            <button onclick="revealResult()" class="mt-auto w-full py-4 text-white rounded-xl font-bold text-xl uppercase tracking-widest shadow-xl hover:scale-[1.01] transition-all flex items-center justify-center gap-3 bg-gradient-to-r from-slate-800 to-slate-900 border border-slate-700 hover:border-amber-500/50 group relative overflow-hidden">
                                                <span class="absolute inset-0 bg-amber-500/10 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></span>
                                                <span class="group-hover:text-amber-400 transition-colors relative z-10">${t.clash}</span>
                                                <i data-lucide="swords" class="w-6 h-6 group-hover:text-amber-400 transition-colors relative z-10 group-hover:rotate-180 duration-500"></i>
                                            </button>
                                        </div>
                                    `}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
        }
        
        function renderFinal(container, t) {
            const sorted = [...state.players].sort((a, b) => b.score - a.score);
            const winner = sorted[0];
            
            // Helper to get rank styles
            const getRankStyle = (idx) => {
                if (idx === 0) return "bg-gradient-to-r from-yellow-900/40 to-amber-900/20 border-yellow-500/50 shadow-[0_0_20px_rgba(234,179,8,0.1)] scale-[1.02]";
                if (idx === 1) return "bg-gradient-to-r from-slate-800/60 to-slate-700/30 border-slate-400/50 shadow-[0_0_15px_rgba(148,163,184,0.1)]";
                if (idx === 2) return "bg-gradient-to-r from-orange-900/30 to-red-900/10 border-orange-700/50 shadow-[0_0_15px_rgba(249,115,22,0.1)]";
                return "bg-slate-900/40 border-slate-800 hover:bg-slate-800/60";
            };

            // Helper for rank icons
            const getRankIcon = (idx) => {
                if (idx === 0) return `<div class="relative"><i data-lucide="crown" class="w-6 h-6 text-yellow-400 fill-yellow-400/20"></i><div class="absolute inset-0 bg-yellow-400 blur-lg opacity-40"></div></div>`;
                if (idx === 1) return `<i data-lucide="medal" class="w-6 h-6 text-slate-300"></i>`;
                if (idx === 2) return `<i data-lucide="medal" class="w-6 h-6 text-orange-400"></i>`;
                return `<span class="text-slate-600 font-mono font-bold text-lg">#${idx + 1}</span>`;
            };

            // Unique colors for names
            const nameColors = [
                'text-yellow-200', 'text-blue-300', 'text-emerald-300', 'text-purple-300', 
                'text-pink-300', 'text-orange-300', 'text-cyan-300', 'text-lime-300'
            ];

            container.innerHTML = `
                <div class="fixed inset-0 z-50 flex items-center justify-center bg-[#020617] animate-in fade-in duration-700">
                     <!-- Background Effects -->
                     <div class="absolute inset-0 overflow-hidden pointer-events-none">
                        <div class="stars opacity-50"></div>
                        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-amber-500/10 blur-[120px] rounded-full animate-pulse"></div>
                     </div>

                     <div class="relative z-10 flex flex-col items-center w-full max-w-5xl h-full md:h-auto md:max-h-[90vh] p-4 md:p-8">
                        
                        <!-- Winner Header -->
                        <div class="text-center mb-10 relative group">
                            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 bg-yellow-500/30 blur-2xl rounded-full group-hover:bg-yellow-500/40 transition-colors duration-1000"></div>
                            <div class="mb-6 inline-block animate-bounce relative z-10">
                                <i data-lucide="crown" class="w-24 h-24 text-yellow-400 fill-yellow-400/20 drop-shadow-[0_0_15px_rgba(250,204,21,0.8)]"></i>
                            </div>
                            <h1 class="text-5xl md:text-7xl font-serif font-bold text-transparent bg-clip-text bg-gradient-to-b from-amber-100 via-yellow-300 to-amber-600 mb-3 drop-shadow-2xl tracking-tight">
                                ${winner.name}
                            </h1>
                            <div class="flex items-center justify-center gap-4 text-amber-500/80 font-bold tracking-[0.4em] text-sm md:text-lg uppercase">
                                <span class="h-px w-12 bg-gradient-to-r from-transparent to-amber-500"></span>
                                ${t.grand_winner}
                                <span class="h-px w-12 bg-gradient-to-l from-transparent to-amber-500"></span>
                            </div>
                        </div>

                        <!-- Leaderboard List -->
                        <div class="w-full max-w-3xl flex-1 overflow-y-auto custom-scrollbar pr-2 mb-8 space-y-3 relative z-10">
                            ${sorted.map((p, idx) => {
                                const isTop3 = idx < 3;
                                const nameColor = nameColors[idx % nameColors.length];
                                
                                return `
                                <div class="flex items-center justify-between p-4 rounded-xl border transition-all hover:scale-[1.01] group ${getRankStyle(idx)}">
                                    <div class="flex items-center gap-6">
                                        <div class="w-10 flex justify-center shrink-0">
                                            ${getRankIcon(idx)}
                                        </div>
                                        <div class="flex flex-col">
                                            <span class="text-lg md:text-xl font-bold ${isTop3 ? 'text-white' : 'text-slate-300'} ${isTop3 ? '' : nameColor} tracking-wide">
                                                ${p.name}
                                            </span>
                                            ${isTop3 ? `<span class="text-[13px] uppercase tracking-widest opacity-60 ${idx===0 ? 'text-yellow-200' : 'text-slate-400'}">Rank ${idx+1}</span>` : ''}
                                        </div>
                                    </div>
                                    
                                    <div class="flex items-center gap-4">
                                        <div class="text-right">
                                            <div class="text-2xl font-mono font-bold ${idx === 0 ? 'text-yellow-400' : 'text-white'} drop-shadow-sm">
                                                ${p.score} <span class="text-xs opacity-50 font-sans">${t.points}</span>
                                            </div>
                                        </div>
                                        <button onclick="setViewingPlayer(${p.id})" class="p-2.5 rounded-lg bg-slate-950/50 border border-white/5 text-slate-400 hover:text-white hover:bg-indigo-500/20 hover:border-indigo-500/50 transition-all" title="${t.view_arsenal}">
                                            <i data-lucide="eye" class="w-5 h-5"></i>
                                        </button>
                                    </div>
                                </div>`;
                            }).join('')}
                        </div>

                        <!-- Footer Buttons -->
                        <button onclick="startWar()" class="group relative px-10 py-4 bg-gradient-to-r from-amber-600 to-orange-700 hover:from-amber-500 hover:to-orange-600 text-white font-bold text-lg uppercase tracking-widest rounded-full shadow-[0_0_30px_rgba(245,158,11,0.3)] hover:shadow-[0_0_50px_rgba(245,158,11,0.5)] transition-all transform hover:scale-105 border border-white/10">
                            <span class="absolute inset-0 rounded-full bg-white/20 blur opacity-0 group-hover:opacity-100 transition-opacity duration-500"></span>
                            <div class="flex items-center gap-3 relative z-10">
                                <i data-lucide="refresh-cw" class="w-5 h-5 group-hover:rotate-180 transition-transform duration-700"></i>
                                ${t.reincarnate}
                            </div>
                        </button>
                     </div>
                </div>`;
        }
        
        function renderArsenalModal(player, t) {
             const getAvg = (stats) => Math.round(Object.values(stats).reduce((a,b)=>a+b,0) / 6);
             return `
                <div class="fixed inset-0 z-[70] flex items-center justify-center bg-black/95 backdrop-blur-md fade-in p-4">
                    <div class="relative w-full max-w-6xl h-[90vh] flex flex-col bg-slate-950 rounded-2xl border border-slate-800 shadow-2xl overflow-hidden">
                         <div class="p-4 border-b border-slate-800 flex justify-between items-center bg-slate-900/50">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center text-lg font-bold text-white shadow-lg">${player.name ? player.name[0] : '?'}</div>
                                <div><h2 class="text-2xl font-bold text-white font-serif tracking-wide">${player.name}'s Arsenal</h2><p class="text-xs text-slate-400 uppercase tracking-widest">Battle History Analysis</p></div>
                            </div>
                            <button onclick="setViewingPlayer(null)" class="p-2 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white transition-colors"><i data-lucide="x" class="w-6 h-6"></i></button>
                         </div>
                         <div class="flex-1 overflow-y-auto custom-scrollbar p-6 bg-slate-950 relative">
                            <div class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] pointer-events-none"></div>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 relative z-10">
                                ${player.usedWeapons.map((weapon, i) => {
                                    const avgPower = getAvg(weapon.stats);
                                    return `<div class="bg-slate-900/90 backdrop-blur-sm border rounded-xl overflow-hidden flex flex-col shadow-xl transition-all hover:scale-[1.01] hover:shadow-2xl" style="border-color: ${weapon.color}60">
                                            <!-- Header Image -->

                                            <div class="h-80 bg-black relative group overflow-hidden">
                                                <div class="absolute inset-0">${renderCardArt(weapon, true)}</div>
                                                <div class="absolute bottom-3 left-3 z-10"><span class="px-2 py-1 rounded text-[13px] font-bold bg-black/50 border border-white/10 backdrop-blur text-white">ROUND ${i+1}</span></div>
                                                <div class="absolute top-3 left-4 right-4 z-10">
                                                    <div class="text-lg font-bold font-serif truncate drop-shadow-md text-white">${weapon.name}</div>
                                                    <div class="text-[13px] font-hindi text-slate-400">${weapon.name_hi}</div>
                                                </div>
                                            </div>
                                            
                                            <div class="p-4 flex-1 flex flex-col gap-3">
                                                <!-- Top Details -->
                                                <div class="flex justify-between items-center border-b border-white/5 pb-2">
                                                    <div class="flex items-center gap-1.5 text-[13px] font-bold text-indigo-300 uppercase tracking-wide">
                                                        <i data-lucide="sparkles" class="w-3 h-3"></i> ${weapon.deity}
                                                    </div>
                                                    <div class="text-[13px] font-bold text-amber-500 uppercase tracking-wide">${weapon.specialty}</div>
                                                </div>

                                                <!-- Description -->
                                                <div class="text-[13px] text-slate-400 italic leading-relaxed border-l-2 border-slate-700 pl-2 line-clamp-2" title="${weapon.desc}">
                                                    "${weapon.desc}"
                                                </div>

                                                <div class="flex gap-4 py-2">
                                                    <!-- Circle Chart -->
                                                    <div class="flex flex-col items-center gap-1">
                                                        <div class="relative w-14 h-14">
                                                            <svg viewBox="0 0 36 36" class="circular-chart w-full h-full">
                                                                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                                                                <path class="circle" stroke-dasharray="${avgPower}, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" style="stroke: ${weapon.color};" />
                                                            </svg>
                                                            <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-white">${avgPower}</div>
                                                        </div>
                                                        <span class="text-[9px] uppercase font-bold text-slate-500">Avg Power</span>
                                                    </div>
                                                    
                                                    <!-- Stats Bars (Showing ALL stats now) -->
                                                    <div class="flex-1 space-y-1">
                                                        ${Object.keys(weapon.stats).map(k => `<div class="flex items-center gap-2"><div class="w-14 text-[9px] uppercase font-bold text-slate-500 truncate">${t.stats[k]}</div><div class="flex-1 h-1 bg-slate-800 rounded-full overflow-hidden"><div class="stat-fill h-full rounded-full" style="--w: ${weapon.stats[k]}%; background-color: ${STAT_COLORS[k]};"></div></div><div class="w-5 text-[9px] font-mono text-right text-slate-400">${weapon.stats[k]}</div></div>`).join('')}
                                                    </div>
                                                </div>

                                                <!-- Footer Details (History & Weakness) -->
                                                <div class="bg-slate-950/50 rounded-lg p-3 border border-white/5 space-y-2 text-[13px]">
                                                    <div class="flex gap-2">
                                                        <i data-lucide="scroll-text" class="w-3 h-3 text-slate-500 flex-shrink-0 mt-0.5"></i>
                                                        <span class="text-slate-300 line-clamp-2" title="${weapon.history}"><span class="text-amber-500/80 font-bold">History:</span> ${weapon.history}</span>
                                                    </div>
                                                    <div class="flex gap-2 items-start">
                                                        <i data-lucide="shield-alert" class="w-3 h-3 text-red-400 flex-shrink-0 mt-0.5"></i>
                                                        <div class="flex-1">
                                                            <span class="text-red-400/80 font-bold block mb-1">Weaknesses:</span>
                                                            <div class="flex flex-wrap gap-1">
                                                                ${weapon.weaknesses.map(w => `<span class="px-1.5 py-0.5 bg-red-500/10 border border-red-500/20 rounded text-red-300 line-clamp-1">${w}</span>`).join('')}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                    </div>`;
                                }).join('')}
                            </div>
                         </div>
                    </div>
                </div>`;
        }

        // Add listener for slider
        document.getElementById('volume-slider').addEventListener('input', (e) => {
            updateVolume(e.target.value);
        });

        // --- EVENT LISTENERS ---
        
        // Rules Modal
        document.getElementById('rules-btn').onclick = () => {
            const t = getT();
            document.getElementById('modal-container').innerHTML = `
                <div class="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm fade-in p-4">
                    <div class="relative w-full max-w-lg bg-slate-900 rounded-2xl border border-amber-500/30 shadow-2xl p-6 overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-amber-500/50 to-transparent"></div>
                        <button onclick="document.getElementById('modal-container').innerHTML=''" class="absolute top-4 right-4 text-slate-500 hover:text-white transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
                        <h2 class="text-2xl font-bold text-amber-400 mb-6 flex items-center gap-3 font-serif">
                            <i data-lucide="book-open" class="w-6 h-6"></i> ${t.instructions}
                        </h2>
                        <ul class="space-y-3 text-slate-300 text-sm list-disc pl-5 marker:text-amber-500/50 leading-relaxed">
                            ${t.rule_list.map(r => `<li>${r}</li>`).join('')}
                        </ul>
                    </div>
                </div>`;
            lucide.createIcons();
        };

        // Ranking Modal
        document.getElementById('ranking-btn').onclick = () => {
            const t = getT();
            const sorted = [...state.players].sort((a, b) => b.score - a.score);
            document.getElementById('modal-container').innerHTML = `
                <div class="fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm fade-in p-4">
                    <div class="relative w-full max-w-md bg-slate-900 rounded-2xl border border-indigo-500/30 shadow-2xl p-6 flex flex-col max-h-[80vh]">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-indigo-500/50 to-transparent"></div>
                        <button onclick="document.getElementById('modal-container').innerHTML=''" class="absolute top-4 right-4 text-slate-500 hover:text-white transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
                        <h2 class="text-2xl font-bold text-indigo-400 mb-6 flex items-center gap-3 font-serif">
                            <i data-lucide="bar-chart-3" class="w-6 h-6"></i> ${t.current_standings}
                        </h2>
                        <div class="overflow-y-auto custom-scrollbar flex-1 pr-2 space-y-3">
                            ${sorted.map((p, idx) => `
                                <div class="flex items-center justify-between p-3 rounded-xl border ${idx===0 ? 'bg-indigo-900/20 border-indigo-500/50' : 'bg-slate-800/50 border-slate-700/50'}">
                                    <div class="flex items-center gap-3">
                                        <div class="w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${idx===0 ? 'bg-indigo-500 text-white shadow-lg shadow-indigo-500/20' : 'bg-slate-800 text-slate-400'}">
                                            ${idx + 1}
                                        </div>
                                        <span class="font-bold ${idx===0 ? 'text-white' : 'text-slate-300'}">${p.name}</span>
                                    </div>
                                    <span class="font-mono font-bold text-indigo-200">${p.score} ${t.points}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>`;
            lucide.createIcons();
        };

        // Sound Toggle
        document.getElementById('sound-btn').onclick = toggleSound;
        
        // Language Selector
        document.getElementById('lang-select').onchange = (e) => { 
            state.lang = e.target.value; 
            render(); 
        };

        // Initial setup
        updateSoundIcon();
        render(); // Initialize the game

    </script>
</body>
</html>
